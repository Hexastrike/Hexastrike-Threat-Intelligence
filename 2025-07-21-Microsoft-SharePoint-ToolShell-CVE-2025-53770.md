# 2025-07-21 Microsoft SharePoint ToolShell - CVE-2025-53770

## Summary

- A widespread attack campaign targeting on-premise SharePoint servers began on July 17, 2025.
- Affected versions include SharePoint Server Subscription Edition, 2019, and Enterprise Server 2016.
- Exploited vulnerabilities include CVE-2025-49706 (Authentication Bypass), CVE-2025-49704 (Remote Code Execution), and CVE-2025-53770 (Deserialization).
- Attackers use crafted HTTP requests to upload a malicious ASPX file (`spinstall0.aspx`) to the server.
- The file `spinstall0.aspx` extracts the serverâ€™s MachineKey configuration, including the ValidationKey and DecryptionKey.
- This enables attackers to generate valid `__VIEWSTATE` tokens and execute remote code.

## Detection
- Indicators of compromise include suspicious ASPX files in `C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\*\TEMPLATE\LAYOUTS`.
- IIS logs may show POST requests to `/_layouts/*/ToolPane.aspx` with parameters `DisplayMode=Edit&amp;a=/ToolPane.aspx`.
- GET requests to `/_layouts/*/spinstall0.aspx` using the User-Agent `Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0` may indicate exploitation attempts.
- A successful request to `spinstall0.aspx` that does not return a 4xx response suggests the vulnerability was exploited.

## Recommendations

- Check whether an on-premise SharePoint instance is in use.
  - Affected: SharePoint Server Subscription Edition, 2019, and Enterprise Server 2016
  - Not affected: SharePoint Online
- If applicable, enable AMSI (Antimalware Scan Interface) on affected on-premise servers.
- Verify whether the affected systems are accessible from the internet, as this impacts the risk level.
- Since no patch is currently available, isolate vulnerable systems as a precaution to prevent exploitation.
- If systems are or were publicly accessible, check for signs of compromise:
  - Microsoft Defender detections: `Exploit:Script/SuspSignoutReq.A`, `Trojan:Win32/HijackSharePointServer.A`
  - Suspicious or newly created ASPX files in: `C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\*\TEMPLATE\LAYOUTS`
    - If File Auditing or Sysmon is enabled, use related Windows Events for detection.
  - Review Windows IIS logs (`C:\inetpub\logs\LogFiles\`) for:
    - User-Agent: `Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0`
    - Payload uploads: `spinstall0.aspx`
    - IP addresses: `107[.]191[.]58[.]76`, `104[.]238[.]159[.]149`, `96[.]9[.]125[.]147`, `103[.]186[.]30[.]186`
- Rotate all system credentials and secrets to block potential RCE chaining.
- If compromise cannot be ruled out with certainty, classify the case as a security incident and initiate a forensic investigation.

## Indicators

### Atomic

- 107[.]191[.]58[.]76
- 104[.]238[.]159[.]149
- 96[.]9[.]125[.]147
- 103[.]186[.]30[.]186

### Computed

- 92bb4ddb98eeaf11fc15bb32e71d0a63256a0ed826a03ba293ce3a8bf057a514, web shell (cleartext)
- 27c45b8ed7b8a7e5fff473b50c24028bd028a9fe8e25e5cea2bf5e676e531014, web shell (cleartext)
- 8d3d3f3a17d233bc8562765e61f7314ca7a08130ac0fb153ffd091612920b0f2, web shell (compiled)
- 30955794792a7ce045660bb1e1917eef36f1d5865891b8110bf982382b305b27, PowerShell payload
- 4a02a72aedc3356d8cb38f01f0e0b9f26ddc5ccb7c0f04a561337cf24aa84030, PaloAlto detected .NET payload
- b39c14becb62aeb55df7fd55c814afbb0d659687d947d917512fe67973100b70, PaloAlto detected .NET payload
- fa3a74a6c015c801f5341c02be2cbdfb301c6ed60633d49fc0bc723617741af7, PaloAlto detected .NET payload

## Resources 
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49704
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49706
- https://nvd.nist.gov/vuln/detail/CVE-2025-49704
- https://nvd.nist.gov/vuln/detail/CVE-2025-49706
- https://research.eye.security/sharepoint-under-siege/
- https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/
- https://x.com/codewhitesec/status/1944743478350557232
- https://www.zerodayinitiative.com/advisories/ZDI-25-580/
- https://www.linkedin.com/feed/update/urn:li:activity:7352170352308805632/
- https://github.com/Neo23x0/signature-base/blob/master/yara/expl_sharepoint_jul25.yar
- https://github.com/PaloAltoNetworks/Unit42-timely-threat-intel/blob/main/2025-07-19-Microsoft-SharePoint-vulnerabilities-CVE-2025-49704-and-49706.txt
